import{a as E,v as G,u as w,R as A,p as u,j as e,T as t,ac as M,ad as P,c as l,s as d,$ as y,Q as C,P as b,U as K,V as W,ae as B,W as i}from"./index-fe52dfb8.js";import{R as U}from"./Responser-c160b300.js";import{A as D}from"./AppLink-07d31dc1.js";const V=({afterLoggedIn:a})=>{const o=E(),c=G(),g=w(s=>s.user),m=w(s=>s.app),p=A().pathname,[h,x]=u.useState(""),[j,f]=u.useState(""),[v,n]=u.useState("");function R(s){x(s.target.value)}function S(s){f(s.target.value)}async function F(){n(t.loading+"...");const s=await P({login:h,pword:j});if(s.status==="WRONG")return n(t.wrongAuth);if(s.status==="OK")return l(o),d(o,{message:t.greetings+", "+s.data.name,status:"complete",title:null}),n(""),await y(o),a==null||a(),c.push(C("/")),b(o,s.data);n(t.errorReg+", "+t.errCode+": "+(s.msg||s))}async function N(){const s=await K();if(s.status==="OK")return d(o,{message:t.farewell+", "+g.name,status:"complete",title:null}),x(""),f(""),n(""),W(o);n(t.errorReg+", "+t.errCode+": "+(s.msg||s))}async function O(s){const r=await B(s.credential);if(r.status==="FIRSTTIME")return H(r),l(o),c.push("/googleConfirm");if(r.status==="OK")return l(o),d(o,{message:t.greetings+", "+r.data.name,status:"complete",title:null}),n(""),await y(o),a==null||a(),c.push(C("/")),b(o,r.data);n(t.errorReg+", "+t.errCode+": "+(r.msg||r))}function k(s){console.log("%câ§­ google auth failed","color: #00a3cc",s),n(t.errorReg+", "+t.errCode+": "+JSON.stringify(s))}function T(){l(o)}return e.jsx("div",{children:m.isLogged?e.jsxs("div",{children:[e.jsxs("h4",{children:[t.greetings,", ",g.name]}),e.jsx("button",{className:"primary",onClick:N,children:t.logout})]}):e.jsxs("div",{children:[e.jsxs("div",{className:p!=="/auth"?"login-form login-form-bordered mp-border-secondary":"login-form",children:[e.jsxs("label",{htmlFor:"name",children:[t.yourLogin,":"]}),e.jsx("input",{type:"text",name:"login",value:h,onInput:R,autoFocus:!0}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"pword",children:[t.yourPword,":"]}),e.jsx("input",{type:"password",name:"pword",value:j,onInput:S}),e.jsx(U,{message:v,setMessage:n}),e.jsx("button",{className:"primary mp-border-accent loginBtn",onClick:F,children:t.confirm}),e.jsx(M,{shape:"rectangular",onSuccess:O,onError:k,width:200,theme:m.theme==="dark"?"filled_black":"outline"})]}),p!=="/auth"&&e.jsx("div",{className:"align-center",children:e.jsx(D,{to:"/auth?reg=true",onClick:T,children:e.jsx("button",{className:"button",children:t.register})})})]})})};function H(a){i.name=a.data.name,i.login=a.data.login,a.data.login||(i.occupiedLogin=a.data.email),i.avatar=a.data.avatar,i.id=a.data.id}export{V as Login};
