import{o as n,q as w,u as b,j as i,M as D,r as k}from"./index-fba14b29.js";import{S as G}from"./SearchBar-1ce39400.js";import{c as M,m as O,b as $,T as q}from"./TotalRating-3eb051f9.js";import{s as z}from"./url-6d62d571.js";import{g as A}from"./helperFuncs-a769e162.js";import"./tags-4c577234.js";const F="_container_c3z8_1",B={container:F},U="_cityItem_yifel_1",H="_geojsonPreview_yifel_10",L="_cityDetails_yifel_18",V="_cityName_yifel_22",X="_cityRating_yifel_28",l={cityItem:U,geojsonPreview:H,cityDetails:L,cityName:V,cityRating:X};function h(c){var t=[1/0,1/0,-1/0,-1/0];return M(c,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}h.default=h;const Y=({amount:c,rating:t,en:e,ru:f,lat:o,lng:y,geometry:d})=>{const u=n.useRef(null),[m,_]=n.useState(null),j=w(),C=b(s=>s.app.mapRef),v=n.useCallback(()=>{const s=x;console.log("%câ§­","color: #e50000",{lat:o,lng:y}),z({lat:o,lng:y,zoom:s}),j.push(`/?lat=${o}&lng=${y}&zoom=${s}`),C.flyTo({center:[y,o],zoom:s,speed:.8})},[x]);return n.useEffect(()=>{if(d){const s=O(A(d));_(s)}},[d]),n.useEffect(()=>{if(m&&u.current){const s=u.current,a=s.getContext("2d");if(a){const r=h(m),N=r[2]-r[0],R=r[3]-r[1],E=s.width/N,I=s.height/R,S=getComputedStyle(document.querySelector("html")).getPropertyValue("--secondary");a.fillStyle=S,a.beginPath();const g=$(m);if(Array.isArray(g))for(const p of g[0][0]){const T=(p[0]-r[0])*E,P=s.height-(p[1]-r[1])*I;a.lineTo(T,P)}a.closePath(),a.fill()}}},[m,u]),i.jsxs("div",{className:l.cityItem,children:[i.jsx("div",{className:l.preview,onClick:v,children:i.jsx("canvas",{className:l.geojsonPreview,ref:u})}),i.jsxs("div",{className:l.cityDetails,children:[i.jsx("h2",{className:l.cityName,children:D==="ru"?f:e}),i.jsx("div",{className:l.cityRating,children:i.jsx(q,{rating:t,amount:c})})]})]})};async function Z(){return await k("GET","cities","top",null,!1)()}const x=14;function st(){const[c,t]=n.useState([]),e=c.length?c.map(f=>n.createElement(Y,{...f,key:f.code})):i.jsx("h3",{children:"TEXT.no cities yet"});return n.useEffect(()=>{(async function(){const o=await Z();o.data&&t(o.data)})()},[]),i.jsxs("div",{className:"cities",children:[i.jsx(G,{}),i.jsx("div",{className:B.container,children:e})]})}export{st as Cities,x as ZOOM_ON_CITY};
