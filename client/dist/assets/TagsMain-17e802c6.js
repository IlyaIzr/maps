import{j as s,T as c,a as g,B as f,r as l,s as v,i as y,K as E,u as C,L as w,$ as j,y as N,h as P,S as R,R as p}from"./index-c4876c4f.js";import{S as M}from"./Friends-e25cd60c.js";import{f as q,g as A}from"./tags-aa69b3f7.js";const x=({tagInfo:t,onClick:n})=>{if(!t)return null;function r(){n(t.tag)}return s.jsxs("div",{className:"tagItem cursor-pointer mp-accent-hover transition-small mp-border-dark ",onClick:r,children:[s.jsxs("div",{className:"mp-dark tagWrap",children:[s.jsx("span",{className:"bigHashtag",children:"# "}),s.jsx("span",{className:"tagContent mp-accent",children:t.tag})]}),s.jsxs("p",{className:"tagAmount mp-dark",children:[c.tagsAmount,": ",s.jsx("span",{className:"mp-accent",children:t.amount})]})]})},B=()=>{const t=g(),n=f(),[r,m]=l.useState([]),[o,d]=l.useState([]);l.useEffect(()=>{(async function(){const a=await q();if(a.status!=="OK")return v(t,{message:c.requestError+" #fts1"});m(a.data.recent),d(a.data.popular)})()},[]);function e(a){n.push(`/tags/item/${a}`)}return s.jsxs("div",{children:[s.jsx("h4",{className:"title",children:c.recentTags}),s.jsx("div",{className:"tagsGroup",children:!!r.length&&r.map(a=>s.jsx(x,{tagInfo:a,onClick:e},a.tag+"recent"))}),s.jsx("h4",{className:"title",children:c.mostPopular}),s.jsx("div",{className:"tagsGroup",children:!!o.length&&o.map(a=>s.jsx(x,{tagInfo:a,onClick:e},a.tag+"popular"))})]})},I=({searchResults:t})=>{const n=new URLSearchParams(y().search).get("query"),r=f(),[m,o]=l.useState([]);if(l.useEffect(()=>{if(!t)return;const e={};t.forEach(a=>{if(!e[a.tag])return e[a.tag]={amount:a.amount,places:[a.placeId],tag:a.tag};e[a.tag].amount+=a.amount,e[a.tag].places.push(a.placeId)}),o(Object.values(e))},[t]),!t)return null;if(!t.length)return s.jsx("div",{className:"resultsContainer",children:s.jsx("h5",{children:c.noResults})});function d(e){r.push(`/tags/item/${e}?from=${n}`)}return s.jsx("div",{className:"resultsContainer",children:m.map(e=>s.jsx(x,{tagInfo:e,onClick:d},e.key))})},L=()=>{const t=g(),{tag:n}=E(),r=f(),m=C(i=>i.app.mapRef),[o,d]=l.useState(null);l.useEffect(()=>{e()},[]);async function e(){const i=await A(n);if(console.log("%câ§­","color: #00e600",i),i.status!=="OK")return v(t,{message:c.requestError+" #tow1"});if(!i.data.length)return;const h={amount:0,places:[]};i.data.forEach(u=>{h.amount+=u.amount,h.places.push({...u})}),d(h)}if(!o)return null;function a(){j(t,n),N(t,"tags"),r.push("/")}return s.jsxs("div",{className:"tagOverview",children:[s.jsxs("h3",{className:"title tagWrap",children:[s.jsx("span",{className:"bigHashtag",children:"#"}),s.jsx("span",{className:"tagContent mp-accent",children:n})]}),s.jsxs("p",{className:"subtitle",children:[c.tagsAmount,": ",o.amount]}),s.jsx(w,{to:"/",children:s.jsx("button",{className:"button",onClick:a,children:c.watchAtMap})}),s.jsx("h4",{className:"title titlePopular",children:c.mostPopularPlaces}),s.jsx("div",{className:"tagPlaces",children:!!o.places&&o.places.map(({placeId:i,amount:h,name:u,lng:T,lat:k})=>{u||(u=c.noName);function S(){m.flyTo({center:[T,k],zoom:16,speed:.5}),j(t,n),N(t,"tags"),r.push("/")}return s.jsx("div",{children:s.jsxs("div",{className:"placeInTag",children:[s.jsx("div",{className:"amount mp-accent",title:c.mentionsAmount,children:h}),s.jsxs("div",{className:"placeTagInfo",children:[s.jsx("div",{className:"name",children:u}),s.jsx("button",{className:"button",onClick:S,children:c.show})]})]})},i)})})]})};const F=()=>{const t=g(),[n,r]=l.useState(null);return l.useEffect(()=>{P(t)},[]),s.jsxs("div",{className:"tags",children:[s.jsx(M,{setSearchResults:r}),s.jsxs(R,{children:[s.jsx(p,{exact:!0,path:"/tags",children:s.jsx(B,{})}),s.jsx(p,{path:"/tags/item/:tag",children:s.jsx(L,{})}),s.jsx(p,{path:"/tags/search",children:s.jsx(I,{searchResults:n})})]}),s.jsx("div",{className:"bottom"})]})};export{F as TagsMain};
