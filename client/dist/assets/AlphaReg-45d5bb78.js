import{a as L,q,u as v,O as R,o,P as y,Q as C,j as s,T as e,N}from"./index-09e4430f.js";import{r as E}from"./users-fbd17358.js";import{R as S}from"./Responser-d1196265.js";import{w as F}from"./url-6d62d571.js";const u={login:"",pword:"",name:"",question:e.secretExample,answer:""},P=()=>{const d=L(),g=q(),h=v(r=>r.user),{search:f}=R(),[t,i]=o.useState(u),[x,a]=o.useState(""),l=o.useRef(null),[j,p]=o.useState(!1);o.useEffect(()=>(async function(){h.id&&((await y()).status==="OK"?C(d):a("Ошибка сети"));const r=new URLSearchParams(f);i({...t,login:r.get("login"),name:r.get("name"),level:r.get("level")})}(),()=>{i(u)}),[]);function n(r){i({...t,[r.target.name]:r.target.value})}function w(){p(!1),a(e.secretReplica2),l.current.focus()}async function b(){var c,m;if(!t.login)return a(e.fillRequiredFields);if(t.question&&!t.answer)return t.question===e.secretExample&&p(!0),l.current.focus(),a(e.secretValidation);if(((c=t.question)==null?void 0:c.length)>300)return a((e.field+" "+e.secretQuestion+" "+e.tooLong).toLocaleLowerCase().capitalize());if(((m=t.answer)==null?void 0:m.length)>255)return a((e.field+" "+e.secterAnswer+" "+e.tooLong).toLocaleLowerCase().capitalize());if(t.login.length>50)return a((e.field+" "+e.login+" "+e.tooLong).toLocaleLowerCase().capitalize());if(t.name.length>140)return a((e.field+" "+e.userName+" "+e.tooLong).toLocaleLowerCase().capitalize());const r=await E(t);if(r.status==="OK")a(e.successfullReg),N(d,r.data),i(u),g.push(F("/"));else{if(r.status==="EXISTING")return a(e.loginOccupied+" - "+t.login);if(r.status==="BANEDPWORD")return a(e.bannedPassword+" - "+t.pword);a(e.errorReg+", "+e.errCode+": "+(r.msg||r))}}return s.jsx("div",{className:"auth-container relative",children:s.jsx("div",{className:"absolute center auth-subcontainer",children:s.jsx("div",{className:"auth-action-wrap mp-border-secondary",children:s.jsxs("div",{className:"register-form",children:[s.jsx("h4",{children:"Регистрация по ссылке, без смс"}),s.jsxs("label",{htmlFor:"login",children:[e.login,":"]}),s.jsx("input",{type:"text",name:"login",value:t.login,onInput:n,autoFocus:!0,required:!0}),s.jsx("br",{}),s.jsxs("label",{htmlFor:"name",children:[e.userName,":"]}),s.jsx("input",{type:"text",name:"name",value:t.name,onInput:n,required:!0}),s.jsx("br",{}),s.jsxs("label",{htmlFor:"pword",children:[e.password,":"]}),s.jsx("input",{type:"password",placeholder:"пароль не обязателен",name:"pword",value:t.pword,onInput:n,required:!0}),s.jsx("br",{}),s.jsx("br",{}),s.jsxs("label",{htmlFor:"question",children:[e.secretQuestion,":"]}),s.jsx("br",{}),s.jsx("textarea",{type:"text",name:"question",value:t.question,onInput:n,autoComplete:"false"}),s.jsx("p",{className:"little-hint",children:e.secretHint}),s.jsxs("label",{htmlFor:"answer",children:[e.secterAnswer,":"]}),s.jsx("input",{type:"text",name:"answer",value:t.answer,onInput:n,required:!!t.question,ref:l,autoComplete:"false"}),s.jsx("div",{className:"register-responser",children:s.jsx(S,{message:x,setMessage:a})}),j&&s.jsx("button",{className:"btn-replica mp-border-counter mp-primary-hover",onClick:w,children:e.secretReplica}),s.jsx("button",{className:"mp-border-accent",type:"button",onClick:b,children:e.submit})]})})})})};export{P as AlphaReg};
