import{o as i,q as w,u as b,j as n,M as D,r as k}from"./index-09e4430f.js";import{S as G}from"./SearchBar-c0fca8b8.js";import{c as M,m as O,b as $,T as q}from"./TotalRating-4071d48f.js";import{s as A}from"./url-6d62d571.js";import{g as F}from"./helperFuncs-a769e162.js";import"./tags-ed4fccce.js";const z="_container_1f5s5_1",B={container:z},U="_cityItem_17oj7_1",H="_geojsonPreview_17oj7_19",L="_cityDetails_17oj7_35",V="_cityName_17oj7_43",X="_cityRating_17oj7_55",l={cityItem:U,geojsonPreview:H,cityDetails:L,cityName:V,cityRating:X};function h(o){var t=[1/0,1/0,-1/0,-1/0];return M(o,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}h.default=h;const Y=({amount:o,rating:t,en:e,ru:f,lat:c,lng:u,geometry:d})=>{const m=i.useRef(null),[y,x]=i.useState(null),_=w(),C=b(s=>s.app.mapRef),v=i.useCallback(()=>{const s=p;console.log("%câ§­","color: #e50000",{lat:c,lng:u}),A({lat:c,lng:u,zoom:s}),_.push(`/?lat=${c}&lng=${u}&zoom=${s}`),C.flyTo({center:[u,c],zoom:s,speed:.8})},[p]);return i.useEffect(()=>{if(d){const s=O(F(d));x(s)}},[d]),i.useEffect(()=>{if(y&&m.current){const s=m.current,a=s.getContext("2d");if(a){const r=h(y),N=r[2]-r[0],R=r[3]-r[1],E=s.width/N,I=s.height/R,S=getComputedStyle(document.querySelector("html")).getPropertyValue("--secondary");a.fillStyle=S,a.beginPath();const j=$(y);if(Array.isArray(j))for(const g of j[0][0]){const T=(g[0]-r[0])*E,P=s.height-(g[1]-r[1])*I;a.lineTo(T,P)}a.closePath(),a.fill()}}},[y,m]),n.jsxs("div",{className:l.cityItem,children:[n.jsx("div",{className:l.preview,onClick:v,children:n.jsx("canvas",{className:l.geojsonPreview,ref:m})}),n.jsxs("div",{className:l.cityDetails,children:[n.jsx("h2",{className:l.cityName,children:D==="ru"?f:e}),n.jsx("div",{className:l.cityRating,children:n.jsx(q,{rating:t,amount:o})})]})]})};async function Z(){return await k("GET","cities","top",null,!1)()}const p=14;function st(){const[o,t]=i.useState([]),e=o.length?o.map(f=>i.createElement(Y,{...f,key:f.code})):n.jsx("h3",{children:"TEXT.no cities yet"});return i.useEffect(()=>{(async function(){const c=await Z();c.data&&t(c.data)})()},[]),n.jsxs("div",{className:"cities",children:[n.jsx(G,{}),n.jsx("div",{className:B.container,children:e})]})}export{st as Cities,p as ZOOM_ON_CITY};
