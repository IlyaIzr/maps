(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{36:function(e,t,r){},37:function(e,t,r){},38:function(e,t,r){},42:function(e,t,r){"use strict";r.r(t);var n=r(1),a=r.n(n),c=r(19),s=r.n(c),o=r(3),i=r(18),u=r(6),l=r(2),d=r.n(l),p=r(14),b=r(5),m=r(7),j=r(9),f=r(15),h=r.n(f),g=("https://m4ps.herokuapp.com/"||"http://localhost:1414/")+"api/";function O(e,t,r,n){return v.apply(this,arguments)}function v(){return(v=Object(m.a)(d.a.mark((function e(t,r,n,a){var c,s,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c={method:"GET",headers:{"Content-Type":"application/json"}},e.prev=1,!t){e.next=8;break}return e.next=5,fetch(g+"maps/places?minx=".concat(t,"&miny=").concat(n,"&maxx=").concat(r,"&maxy=").concat(a),c);case 5:s=e.sent,e.next=11;break;case 8:return e.next=10,fetch(g+"maps/places",c);case 10:s=e.sent;case 11:return e.next=13,s.json();case 13:return o=e.sent,e.abrupt("return",o);case 17:return e.prev=17,e.t0=e.catch(1),e.abrupt("return",e.t0);case 20:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=Object(m.a)(d.a.mark((function e(t){var r,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"GET",headers:{"Content-Type":"application/json"}},e.prev=1,e.next=4,fetch(g+"maps/reviews?targetId=".concat(t),r);case 4:return n=e.sent,e.next=7,n.json();case 7:return a=e.sent,e.abrupt("return",a);case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})))).apply(this,arguments)}function w(e){return N.apply(this,arguments)}function N(){return(N=Object(m.a)(d.a.mark((function e(t){var r,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(b.a)({},t))},e.prev=1,e.next=4,fetch(g+"maps/postInitReview",r);case 4:return n=e.sent,e.next=7,n.json();case 7:return a=e.sent,e.abrupt("return",a);case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})))).apply(this,arguments)}function k(e){return S.apply(this,arguments)}function S(){return(S=Object(m.a)(d.a.mark((function e(t){var r,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(b.a)({},t))},e.prev=1,e.next=4,fetch(g+"maps/postNextReview",r);case 4:return n=e.sent,e.next=7,n.json();case 7:return a=e.sent,e.abrupt("return",a);case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})))).apply(this,arguments)}function F(e,t){return C.apply(this,arguments)}function C(){return(C=Object(m.a)(d.a.mark((function e(t,r){var n,a,c,s,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Set(["street_address","natural_feature","airport","park","point_of_interest","establishment","food","store"]),t=Number(t),r=Number(r),e.next=5,window.geocoderRef.geocode({location:{lat:t,lng:r}});case 5:if(a=e.sent,c="",!a.results){e.next=20;break}s=0;case 9:if(!(s<a.results.length)){e.next=20;break}if("premise"!==(o=a.results[s]).types[0]){e.next=14;break}return c=o.formatted_address.split(", ")[0]+", "+o.formatted_address.split(", ")[1],e.abrupt("break",20);case 14:if(!o.types.find((function(e){return n.has(e)}))){e.next=17;break}return c=o.address_components[1].long_name+", "+o.address_components[0].long_name,e.abrupt("break",20);case 17:s++,e.next=9;break;case 20:return e.abrupt("return",c);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return P.apply(this,arguments)}function P(){return(P=Object(m.a)(d.a.mark((function e(t,r){var n,a,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,id:r})},e.prev=1,e.next=4,fetch(g+"maps/postPlaceName",n);case 4:return a=e.sent,e.next=7,a.json();case 7:return c=e.sent,e.abrupt("return",c);case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})))).apply(this,arguments)}var T=["#cd0c0c","#e14612","#e1922c","#e8c337","#94c52f","#0aa112"];function M(e,t){e.on("load",(function(r){e.addSource("ratedFeaturesSource",{type:"geojson",data:{type:"FeatureCollection",features:t}}),e.addSource("selectedFeatureSrc",{type:"geojson",data:{type:"FeatureCollection",features:[]}});var n=e.getStyle().layers.find((function(e){return"symbol"===e.type})).id;e.addLayer({id:"ratedFeatures",source:"ratedFeaturesSource",minzoom:11,type:"fill",paint:{"fill-opacity":.5,"fill-color":["interpolate",["linear"],["get","rating"],0,T[0],1,T[1],2,T[2],3,T[3],4,T[4],5,T[5]]}},n),e.addLayer({id:"selectedFeature",source:"selectedFeatureSrc",minzoom:13,type:"fill",paint:{"fill-opacity":.9,"fill-color":"#ffc900","fill-outline-color":"blue"}},n)}))}function _(e,t,r,n){function a(t){return function(e){if(!e[1])return e[0];var t=window.turf.union(e[0],e[1]);if(e[2])for(var r=2;r<e.length;r++)t=window.turf.union(t,e[r]);return t.geometry}(function(t){var r=e.querySourceFeatures("composite",{filter:["any",["==",["id"],t.id]],sourceLayer:t.sourceLayer});return r.splice(r.length/2),r.map((function(e){return e.geometry}))}(t)||[])}e.on("click",function(){var c=Object(m.a)(d.a.mark((function c(s){var i,u,l,p,m,j,f,h,g,O,v,x,y,w;return d.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(i=function(t){var r=s.lngLat,n=r.lng,a=r.lat;e.flyTo({center:[n,a],zoom:t})},u=e.queryRenderedFeatures(s.point),l=new Set(["building","landuse"]),!(p=u.find((function(e){return"ratedFeaturesSource"===e.source})))){c.next=10;break}return console.log("found rated feature",p),n.trash(),G(e,p),t(p),c.abrupt("return");case 10:if(!(null===(m=u.find((function(e){return l.has(e.sourceLayer)})))||void 0===m?void 0:m.id)){c.next=24;break}return console.log("found feature",m),n.trash(),j=e.getZoom(),f=G(e,m,j<16?16:j),h=Object(o.a)(f,2),g=h[0],O=h[1],v=a(m),c.next=19,F(O,g);case 19:return m.properties.name=c.sent,t(Object(b.a)(Object(b.a)({},m),{},{geometry:v})),c.abrupt("return");case 24:if(!m){c.next=32;break}return console.log("interesting, but no id",m),n.trash(),i(e.getZoom()+1),t(null),c.abrupt("return");case 32:if("mapbox-gl-draw-hot"!==(null===u||void 0===u||null===(x=u[0])||void 0===x?void 0:x.source)){c.next=34;break}return c.abrupt("return");case 34:return console.log("no interesting features",u),y=new Set(["natural_label","place_label","poi_label","housenum_label","airport_label"]),u.find((function(e){return y.has(e.sourceLayer)}))&&(w=e.getZoom()+1)<16&&i(w),r(),c.abrupt("return");case 40:case"end":return c.stop()}}),c)})));return function(e){return c.apply(this,arguments)}}())}function I(){var e=window.localStorage.getItem("lastLocation");if(!e)return{};var t=e=JSON.parse(e);return{lng:t.lng,lat:t.lat}}var B={homeLinkBtn:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f",authLinkBtn:"\u041b\u043e\u0433\u0438\u043d",setsLinkBtn:"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438",login:"\u041b\u043e\u0433\u0438\u043d",logout:"\u0412\u044b\u0439\u0442\u0438",register:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",yourName:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",submit:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c",confirm:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c",greetings:"\u041f\u0440\u0438\u0432\u0435\u0442",firstTimeRate:"\u0412\u0430\u043c \u0432\u044b\u043f\u0430\u043b\u0430 \u0447\u0435\u0441\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u043c \u043e\u0446\u0435\u043d\u0438\u0442\u044c \u044d\u0442\u043e \u043c\u0435\u0441\u0442\u043e!",placeRatingPrefix:"\u041e\u0431\u0449\u0438\u0439 \u0440\u0435\u0439\u0442\u0438\u043d\u0433",placeAmountPrefix:"\u042d\u0442\u043e \u043c\u0435\u0441\u0442\u043e \u043e\u0446\u0435\u043d\u0438\u043b\u0438",placeAmountNumberEnds1:"\u0440\u0430\u0437",placeAmountEndsMultiple:"\u0440\u0430\u0437\u0430",push:"\u041d\u0430\u0436\u0430\u0442\u044c",commentPlacehol:"\u0435\u0441\u0442\u044c \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438?",rating:"\u0412\u0430\u0448\u0430 \u043e\u0446\u0435\u043d\u043a\u0430",bestRating:"\u0417\u0430\u043c\u0435\u0447\u0430\u0442\u0435\u043b\u044c\u043d\u043e",worstRating:"\u0423\u0436\u0430\u0441\u043d\u043e",reviews:"\u041e\u0442\u0437\u044b\u0432\u044b",noComments:"\u0411\u0435\u0437 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u0432",searchPHolder:"\u041d\u0430\u0439\u0442\u0438",newFeature:"\u041d\u043e\u0432\u044b\u0439 \u043e\u0431\u044a\u0435\u043a\u0442 \u043d\u0430 \u043a\u0430\u0440\u0442\u0435",newFeaturePHolder:"\u0410\u0434\u0440\u0435\u0441 \u0438\u043b\u0438 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043c\u0435\u0441\u0442\u0430",drawPromptHeader:"\u0420\u0435\u0436\u0438\u043c \u0440\u0438\u0441\u043e\u0432\u0430\u043d\u0438\u044f",drawPrompt:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435, \u0434\u0432\u0430\u0436\u0434\u044b \u043d\u0430\u0436\u0430\u0432 \u043d\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u044e\u044e \u0442\u043e\u0447\u043a\u0443 \u043f\u043e\u043b\u0438\u0433\u043e\u043d\u0430"};function R(e,t,r,n,a,c){var s=new window.MapboxDraw({displayControlsDefault:!1,controls:{}});function i(e){return u.apply(this,arguments)}function u(){return(u=Object(m.a)(d.a.mark((function n(c){var i,u,l,p,m,j,f;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a(!1),r.style.display="none",(i=s.getAll()).features.length>0&&(u=window.turf.area(i),Math.round(100*u)/100,(l=Object(b.a)({},i.features[0])).properties.amount=0,l.properties.created=!0,l.source="createdPoly",p=Object(o.a)(window.turf.centroid(l.geometry).geometry.coordinates,2),m=p[0],j=p[1],f=e.getZoom(),l._vectorTileFeature={_x:Math.floor((m+180)/360*Math.pow(2,f)),_y:Math.floor((1-Math.log(Math.tan(j*Math.PI/180)+1/Math.cos(j*Math.PI/180))/Math.PI)/2*Math.pow(2,f))},t(l));case 4:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return r.onclick=function(){s.changeMode("draw_polygon"),n.style.display="block",a(!0)},n.onclick=function(){s.deleteAll(),c(),a(!1),r.style.display="block",n.style.display="none"},e.addControl(s),r.style.display="block",n.style.display="none",e.on("draw.create",i),e.on("draw.update",i),s}var E=r(0);h.a.accessToken="pk.eyJ1IjoiaWx5YWl6ciIsImEiOiJja29nNG5rNTkwbGdxMm5sYTFqbXpqbnlpIn0.S4LdF8fBwDtEQ6-dQBrWVw";var W=function(e){var t=e.feature,r=e.setFeature,a=e.resetRater,c=e.geoData,s=e.setGeoData,i=e.featureTrigger,u=Object(n.useRef)(null),l=Object(n.useRef)(null),p=Object(n.useRef)(null),b=Object(n.useRef)(null),j=Object(n.useState)(!1),f=Object(o.a)(j,2),g=f[0],v=f[1];return Object(n.useEffect)((function(){Object(m.a)(d.a.mark((function e(){var t,n,c,o,i,m;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=I(),n=t.lng,c=t.lat,e.next=3,O();case 3:if("OK"===(o=e.sent).status){e.next=6;break}return e.abrupt("return",console.log("bad request",o));case 6:if(!l.current){e.next=8;break}return e.abrupt("return");case 8:d=o.data,i=(null===d||void 0===d?void 0:d.length)?d.map((function(e){var t,r={type:"Feature",geometry:{type:"MultiPolygon"},id:e.id,properties:{rating:Number(e.rating),amount:e.amount,name:e.name,lng:e.lng,lat:e.lat},source:"composite",sourceLayer:"building"};return r.geometry.coordinates=null===e||void 0===e||null===(t=e.polygon)||void 0===t?void 0:t.map((function(e){return e.map((function(e){return e.map((function(e){return[e.x,e.y]}))}))})),r})):[],s(i),l.current=new h.a.Map({container:u.current,style:"mapbox://styles/ilyaizr/ckpk88ybo17tn17mzmd5etst8",center:[n||34.354,c||53.235],zoom:16}),l.current.addControl(new window.MapboxGeocoder({accessToken:"pk.eyJ1IjoiaWx5YWl6ciIsImEiOiJja29nNG5rNTkwbGdxMm5sYTFqbXpqbnlpIn0.S4LdF8fBwDtEQ6-dQBrWVw",mapboxgl:h.a,placeholder:B.searchPHolder})),m=R(l.current,r,p.current,b.current,v,a),M(l.current,i),_(l.current,r,a,m),window.geocoderRef=new window.google.maps.Geocoder;case 16:case"end":return e.stop()}var d}),e)})))();var e=setInterval((function(){var e,t,r=null===(e=l.current)||void 0===e||null===(t=e.getCenter)||void 0===t?void 0:t.call(e);r&&function(e){var t=e.lng,r=e.lat;window.localStorage.setItem("lastLocation",JSON.stringify({lng:t,lat:r}))}(r)}),1e4);return function(){return clearInterval(e)}}),[]),Object(n.useEffect)((function(){l.current&&D(l.current,c,"ratedFeaturesSource")}),[i]),Object(n.useEffect)((function(){l.current&&D(l.current,[t||{}],"selectedFeatureSrc")}),[t]),Object(E.jsxs)("div",{children:[Object(E.jsx)("div",{ref:u,className:"map-container"}),Object(E.jsx)("button",{id:"createBtn",ref:p,className:"mp-bg-light mp-border-primary controlButton",children:Object(E.jsx)("img",{src:"/icons/edit-pen.svg",alt:"draw area"})}),Object(E.jsx)("button",{id:"deleteBtn",ref:b,className:"mp-bg-light mp-border-primary controlButton",children:Object(E.jsx)("img",{src:"/icons/trash.svg",alt:"cancel drawing"})}),g&&Object(E.jsxs)("div",{className:"controlPrompt mp-border-counter mp-bg-light",children:[Object(E.jsx)("h6",{children:B.drawPromptHeader}),Object(E.jsx)("p",{children:B.drawPrompt})]}),Object(E.jsxs)("div",{className:"calculation-box",children:[Object(E.jsx)("p",{children:"Draw a polygon using the draw tools."}),Object(E.jsx)("div",{id:"calculated-area"})]})]})};function D(e,t,r){e.getSource(r).setData({type:"FeatureCollection",features:t})}function G(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Object(o.a)(window.turf.centroid(t.geometry).geometry.coordinates,2),c=a[0],s=a[1];return e.flyTo({center:[c,s],zoom:r,speed:n}),[c,s]}var A=function(e){var t=e.rating,r=e.setRating,a=e.comment,c=e.setComment,s=e.onSubmit,i=Object(n.useState)(0),u=Object(o.a)(i,2),l=u[0],d=u[1];function b(e){r(l)}function m(e){d(Number(e.target.name))}function j(){d(t)}return Object(E.jsxs)("div",{className:"rater",children:[Object(E.jsxs)("div",{className:"stars",children:[Object(E.jsxs)("h5",{className:"starRating",children:[B.rating," :"]})," ",Object(E.jsx)("span",{className:"hoverValue mp-dark",children:l}),Object(E.jsx)("br",{}),Object(p.a)(Array(5)).map((function(e,r){return r+=1,Object(E.jsx)("button",{type:"button",name:r,className:r<=(l||t)?"mp-accent starButton":"mp-secondary starButton",onClick:b,onMouseEnter:m,onMouseLeave:j,style:r<=(l||t)?{color:T[l]}:{},children:Object(E.jsx)("span",{className:"star",children:"\u2605"})},r)}))]}),Object(E.jsx)("textarea",{name:"comment",cols:"31",rows:"2",value:a,onInput:function(e){c(e.target.value)},className:"raterComment",placeholder:B.commentPlacehol}),Object(E.jsx)("div",{className:"raterBtnContainer",children:Object(E.jsx)("button",{type:"button",onClick:function(){d(0),s()},children:B.push})})]})},J=function(e){var t=e.feature,r=e.name,a=e.setName;function c(){return(c=Object(m.a)(d.a.mark((function e(){var r,n,a,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.properties,n=r.lat,a=r.lng,e.next=3,F(n,a);case 3:return c=e.sent,console.log("%c\u29ed","color: #ff6600",c),e.next=7,L(c,t.id);case 7:s=e.sent,console.log("%c\u29ed","color: #40fff2",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}if(Object(n.useEffect)((function(){(null===t||void 0===t?void 0:t.name)&&a(t.properties.name),console.log("%c\u29ed","color: #d0bfff",t)}),[t,a]),!(null===t||void 0===t?void 0:t.source))return console.log("wtf feature",t),null;if("ratedFeaturesSource"===t.source)return Object(E.jsxs)("div",{className:"featurer",children:[Object(E.jsxs)("p",{className:"rateAmount",children:[B.placeAmountPrefix+" "+t.properties.amount+" ",String(t.properties.amount).endsWith("1")?B.placeAmountNumberEnds1:B.placeAmountEndsMultiple]}),Object(E.jsxs)("h5",{className:"rateValue",children:[B.placeRatingPrefix,":",Object(E.jsxs)("span",{className:"rateNumber",children:[" ",t.properties.rating]})]}),t.properties.name?Object(E.jsx)("div",{className:"featureNameWrap",children:Object(E.jsx)("p",{className:"featureName mp-bg-counter mp-border-primary mp-primary",children:t.properties.name})}):Object(E.jsx)(E.Fragment,{}),Object(E.jsx)("button",{onClick:function(){return c.apply(this,arguments)},children:"add name"})]});return"createdPoly"===t.source?Object(E.jsxs)("div",{className:"featurer",children:[Object(E.jsx)("p",{className:"featurerGreetings",children:B.newFeature}),Object(E.jsx)("div",{className:"featureNameWrap",children:Object(E.jsx)("input",{type:"text",value:r,onInput:function(e){a(e.target.value),t.properties.name=e.target.value},placeholder:B.newFeaturePHolder,title:B.newFeaturePHolder,className:"featureName mp-bg-counter mp-border-counter  mp-primary"})})]}):Object(E.jsxs)("div",{className:"featurer",children:[Object(E.jsx)("p",{className:"featurerGreetings",children:B.firstTimeRate}),t.properties.name?Object(E.jsx)("div",{className:"featureNameWrap",children:Object(E.jsx)("p",{className:"featureName mp-bg-counter mp-border-primary  mp-primary",children:t.properties.name})}):Object(E.jsx)(E.Fragment,{})]})};function q(e){var t;t="Polygon"===e.type?[e.coordinates]:e.coordinates;var r=-90,n=-180,a=90,c=180,s=[];t.forEach((function(e){s.push(function(e){var t=[];return e.forEach((function(e,s){t.push("("),e.forEach((function(e,i){var u=Object(o.a)(e,2),l=u[0],d=u[1];l<c&&(c=l),l>n&&(n=l),d>r&&(r=d),d<a&&(a=d),t[s]+=(i?", ":"")+String(l)+" "+String(d)})),t[s]+=")"})),"("+t.join(",")+")"}(e))}));var i="MULTIPOLYGON("+s.join(", ")+")";return[[n,r],[c,a],i]}r(36);var z=function(){return Object(E.jsx)("div",{className:"mapLegend mp-bg-light mp-border-secondary mp-shadow-light",children:Object(E.jsxs)("div",{className:"ratingLegend",children:[Object(E.jsxs)("div",{className:"ratingDescription",children:[Object(E.jsx)("span",{children:B.worstRating}),Object(E.jsx)("span",{}),Object(E.jsx)("span",{}),Object(E.jsx)("span",{}),Object(E.jsx)("span",{children:B.bestRating})]}),Object(E.jsx)("div",{className:"ratingUnitsWrap",children:T.map((function(e,t){return Object(E.jsx)("div",{className:"ratingUnit",children:Object(E.jsx)("span",{className:"ratingColor",style:{backgroundColor:e}})},e+t)}))}),Object(E.jsx)("div",{className:"ratingGradientWrap",children:Object(E.jsx)("div",{className:"ratingGradient",style:{background:"linear-gradient(90deg, ".concat(T[0],", ").concat(T[3],", ").concat(T[5],")")}})})]})})},H="app/log_in",Y="app/log_out",K="app/expand_comms",Q="app/shrink_comms",U={isLogged:!1,language:"en",reviewsShown:!0};var V=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e(t?{type:H}:{type:Y})},Z=function(e){var t=e.feature,r=Object(j.b)(),a=Object(j.c)((function(e){return e.app})).reviewsShown,c=Object(n.useState)([]),s=Object(o.a)(c,2),i=s[0],u=s[1];return Object(n.useEffect)((function(){return Object(m.a)(d.a.mark((function e(){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("ratedFeaturesSource"===(null===t||void 0===t?void 0:t.source)){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,x(t.id);case 4:if("OK"===(r=e.sent).status){e.next=7;break}return e.abrupt("return",console.log("error with res",r));case 7:u(r.data);case 8:case"end":return e.stop()}}),e)})))(),function(){u([])}}),[null===t||void 0===t?void 0:t.source,null===t||void 0===t?void 0:t.id]),"ratedFeaturesSource"!==(null===t||void 0===t?void 0:t.source)?null:Object(E.jsxs)("div",{className:"reviewsContainer ".concat(a?"expanded":"shrinked"),children:[i.length?i.map((function(e){var t,r;return Object(E.jsxs)("div",{className:"reviewWrap mp-border-secondary mp-shadow-light",children:[Object(E.jsx)("div",{className:"authorLogo mp-bg-counter",children:Object(E.jsx)("span",{className:"mp-primary",title:e.author,children:null===(t=String(e.author))||void 0===t||null===(r=t[0])||void 0===r?void 0:r.toUpperCase()})}),Object(E.jsxs)("div",{className:"reviewBody",children:[Object(E.jsx)("p",{className:"author",children:e.author}),Object(E.jsx)("div",{className:"reviewDate mp-secondary",children:new Date(e.timestamp).toLocaleDateString()}),Boolean(e.comment)&&Object(E.jsx)("div",{className:"reviewComment mp-bg-primary",children:e.comment}),Object(E.jsxs)("div",{className:"reviewRating",children:[e.grade,"/5",Object(E.jsx)("span",{className:"reviewStars stars",children:Object(p.a)(Array(5)).map((function(t,r){return r+=1,Object(E.jsx)("span",{className:r<=e.grade?"mp-accent starButton":"mp-secondary starButton",children:"\u2605"},r)}))})]})]})]},e.author+e.grade+Math.random())})):Object(E.jsx)("div",{children:B.noreviews}),Object(E.jsx)("div",{className:"skipperContainer",children:Object(E.jsx)("div",{className:"skipper mp-bg-light mp-border-secondary",onClick:function(){a?r({type:Q}):function(e){e({type:K})}(r)},children:a?Object(E.jsx)("span",{className:"mp-secondary",children:"\u21a5"}):Object(E.jsx)("span",{className:"mp-secondary",children:"\u21a7"})})})]})},X=function(){var e=Object(j.c)((function(e){return e.user})),t=Object(n.useState)(""),r=Object(o.a)(t,2),a=r[0],c=r[1],s=Object(n.useState)(0),i=Object(o.a)(s,2),u=i[0],l=i[1],f=Object(n.useState)(""),g=Object(o.a)(f,2),O=g[0],v=g[1],x=Object(n.useState)(null),y=Object(o.a)(x,2),N=y[0],S=y[1],F=Object(n.useState)(null),C=Object(o.a)(F,2),L=C[0],P=C[1],T=Object(n.useState)(0),M=Object(o.a)(T,2),_=M[0],I=M[1],B=Object(n.useState)(0),R=Object(o.a)(B,2),D=R[0],G=R[1];function H(){I(_+1)}function Y(){l(0),v(""),c(""),S(null)}function K(){return(K=Object(m.a)(d.a.mark((function t(){var r,n,c,s,i,l,m,j,f,g,v,x,y,S,F,C,T;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=q(N.geometry),n=Object(o.a)(r,3),c=n[0],s=n[1],i=n[2],l=new h.a.LngLatBounds(c,s),m=l.getCenter(),j=m.lng,f=m.lat,g={comment:O,grade:u,targetId:N.id},v={lng:j,lat:f,x:N._vectorTileFeature._x,y:N._vectorTileFeature._y,id:N.id,name:N.properties.name||"",polyString:i},"ratedFeaturesSource"!==N.source){t.next=23;break}return t.next=8,k({user:e.login,review:g,place:Object(b.a)(Object(b.a)({},N.properties),{},{id:N.id})});case 8:if("OK"===(x=t.sent).status){t.next=11;break}return t.abrupt("return",console.log("%c\u29ed","color: #bf1d00",x));case 11:y=0;case 12:if(!(y<L.length)){t.next=20;break}if(L[y].id!==N.id){t.next=17;break}return S=N.properties,F=S.amount,C=S.rating,L[y].properties={rating:+((F*C+g.grade)/(F+1)).toFixed(5),amount:F+1},t.abrupt("break",20);case 17:y++,t.next=12;break;case 20:return P(L),H(),t.abrupt("return",Y());case 23:return P([].concat(Object(p.a)(L),[{type:"Feature",properties:{rating:u,name:a,amount:1},id:N.id,geometry:N.geometry}])),H(),t.next=27,w({user:e.login,review:g,place:v});case 27:if("OK"===(T=t.sent).status){t.next=30;break}return t.abrupt("return",console.log("%c\u29ed","color: #bf1d00",T));case 30:"createdPoly"===N.source&&G(D+1),Y();case 32:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(E.jsxs)("div",{children:[Object(E.jsx)(W,{feature:N,setFeature:S,resetRater:Y,geoData:L,setGeoData:P,featureTrigger:_},D),Object(E.jsx)(z,{}),N&&Object(E.jsxs)("div",{className:"featureContainer mp-bg-light mp-border-secondary",children:[Object(E.jsx)(J,{feature:N,name:a,setName:c}),Object(E.jsx)(A,{rating:u,setRating:l,comment:O,setComment:v,onSubmit:function(){return K.apply(this,arguments)}}),Object(E.jsx)(Z,{feature:N}),Object(E.jsx)("div",{className:"closeFeature",onClick:Y,children:"\u2715"})]})]})},$="user/set_credentials",ee="user/set_level",te={name:"anonimus",login:"anonimus",level:0,id:1};var re=function(e,t,r,n){e({type:$,credentials:{name:t,login:r,id:n}})},ne=function(e,t,r,n){re(e,t,r,n),V(e,!0)},ae=function(){var e=Object(n.useState)(""),t=Object(o.a)(e,2),r=t[0],a=t[1],c=Object(j.b)(),s=Object(j.c)((function(e){return e.user})),i=Object(j.c)((function(e){return e.app}));return Object(n.useEffect)((function(){r!==s.name&&a(s.name)}),[s.name,r]),Object(E.jsx)("div",{children:i.isLogged?Object(E.jsxs)("div",{children:[Object(E.jsxs)("h4",{children:[B.greetings,", ",r]}),Object(E.jsx)("button",{className:"primary",onClick:function(){var e;window.localStorage.clear(),a(""),re(e=c,"","",""),V(e,!1)},children:B.logout})]}):Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("label",{htmlFor:"name",children:B.yourName}),Object(E.jsx)("input",{type:"text",name:"name",value:r,onInput:function(e){a(e.target.value)}}),Object(E.jsx)("button",{className:"primary",onClick:function(){ne(c,r,r,r+"-"+Math.floor(1e3*Math.random())),window.localStorage.setItem("usernameTemp",r)},children:B.confirm})]})})},ce=function(){return Object(E.jsx)("div",{children:"TBC"})},se=function(){var e=Object(n.useState)(!0),t=Object(o.a)(e,2),r=t[0];t[1];return Object(E.jsx)("div",{children:r?Object(E.jsx)(ae,{}):Object(E.jsx)(ce,{})})};r(37),r(38);var oe=function(){var e=Object(n.useState)(!0),t=Object(o.a)(e,2),r=t[0],a=t[1],c=Object(j.b)();return Object(n.useEffect)((function(){var e=window.localStorage.getItem("usernameTemp");e&&ne(c,e,e,e+"-"+Math.floor(1e3*Math.random()))}),[]),Object(E.jsxs)(i.a,{children:[Object(E.jsxs)("div",{className:"mainNavigation mp-bg-light mp-border-secondary",children:[Object(E.jsx)(i.b,{className:"mp-border-secondary",to:"/",onClick:function(){return a(!0)},children:B.homeLinkBtn}),Object(E.jsx)(i.b,{className:"mp-border-secondary",to:"/auth",onClick:function(){return a(!1)},children:B.authLinkBtn}),Object(E.jsx)(i.b,{className:"mp-border-secondary",to:"/settings",onClick:function(){return a(!1)},children:B.setsLinkBtn})]}),Object(E.jsx)("div",{className:r?"mainWrapper":"hidden",children:Object(E.jsx)(X,{})}),Object(E.jsxs)(u.c,{children:[Object(E.jsx)(u.a,{path:"/settings",children:Object(E.jsx)("div",{className:"routeWrapper",children:"Settings component will be released soon"})}),Object(E.jsx)(u.a,{path:"/auth",children:Object(E.jsx)("div",{className:"routeWrapper",children:Object(E.jsx)(se,{})})})]})]})},ie=(r(41),r(26)),ue=Object(ie.a)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case $:return Object(b.a)(Object(b.a)({},e),t.credentials);case ee:return Object(b.a)(Object(b.a)({},e),{},{level:t.newLevel});default:return e}},app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case H:return Object(b.a)(Object(b.a)({},e),{},{isLogged:!0});case Y:return Object(b.a)(Object(b.a)({},e),{},{isLogged:!1});case Q:return Object(b.a)(Object(b.a)({},e),{},{reviewsShown:!1});case K:return Object(b.a)(Object(b.a)({},e),{},{reviewsShown:!0});default:return e}}}),le=Object(ie.b)(ue),de=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,43)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;r(e),n(e),a(e),c(e),s(e)}))};s.a.render(Object(E.jsx)(a.a.StrictMode,{children:Object(E.jsx)(j.a,{store:le,children:Object(E.jsx)(oe,{})})}),document.getElementById("root")),de()}},[[42,1,2]]]);
//# sourceMappingURL=main.33a777a3.chunk.js.map